# 浏览器工作原理

## 浏览器的组成
- 人机交互部分（UI）
- 网络请求部分（Socket）
- JavaScript引擎部分（解析执行JavaScript）
- 渲染引擎部分

## 主流渲染引擎

### 介绍
1. 渲染引擎 又叫 排版引擎 或 浏览器内核
2. 主流的 渲染引擎 有
	- **Chrome浏览器**：Blink引擎（WebKit的一个分支）。
	- **Safari浏览器**：WebKit引擎，windows版本2008年3月18日推出正式版，但苹果已于2012年7月25日停止开发Windows版的Safari。
	- **Firefox**浏览器：Gecko引擎。
	- **Opera浏览器**：Blink引擎（早期版使用Presto引擎）。
	- **Internet Explorer浏览器**:Trident引擎。
	- **Microsoft Edge浏览器**：EdgeHTML引擎（Trident的一个分支）。

### 工作原理
1. 解析HTML构建Dom树(Document Object Model,文档对象模型)，DOM是W3C组织推荐的处理可扩展置标语言的标准编程接口。
2. 构建渲染树，渲染树并不等同于Dom树，因为像head标签或者display：none这样的元素就没有必要放到渲染树中了，但是它们在DOM树中。
3. 对渲染树进行布局，定位坐标和大小、确定是否换行、确定Position、overflow、z-index等等，这个过程叫layout或reflow。
4. 绘制渲染树，调用操作系统底层API进行绘图操作

### 浏览器访问网站过程
1. 在浏览器地址栏中输入网址
2. 浏览器通过用户在地址栏中输入的URL构建HTTP请求报文
3. 浏览器发起DNS解析请求，将域名转换为IP地址
4. 浏览器将请求报文发送服务器
5. 服务器接受请求，并且解析
6. 服务器处理用户请求，并将处理结果封装成HTTP响应报文
7. 服务器将HTTP响应报文发送服务器
8. 浏览器接受服务器响应的HTTP报文，并解析
9. 浏览器解析HTML页面并展示，在解析HTML页面时遇到新的资源需要再次发起请求
10. 最终浏览器展示出了页面

### 为什么建立TCP连接需要3次握手？three-wayHandShake
- 是为了防止已失效的连接请求报文段突然有传送到了服务器，因而产生错误。
- 举例：已失效的连接请求报文段的产生在这样一种情况下：client发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到server。本来这是一个早已失效的报文段，但server收到此时萧的连接请求报文段后，就误以为是client再次发出的一个新的连接请求。于是就向Client发出确认报文段，同意建立连接，假设不采用“三次握手”，那么只要server发出确认，新的连接就建立了。由于现在client并没有发出建立连接的请求，因此不会理睬server的确认，也不会向server发送请求数据，但server却以为新的运输连接已经建立，并一直等待client发来数据，这样，server的很多资源就白白浪费掉了。采用“三次握手”的办法可以阻止上述现象发生。例如刚才那种情况，client不会向server发送确认，server由于收不到确认，就知道client并没有要求建立连接
- 总结：TCP的三次握手是为了建立可靠的信道
